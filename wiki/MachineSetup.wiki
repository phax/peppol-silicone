#summary Installation instructions to be performed to run PEPPOL application

----

=_This page is discontinued_ - read the PDF document [https://joinup.ec.europa.eu/svn/peppol/PEPPOL_EIA/1-ICT_Architecture/1-ICT-Transport_Infrastructure/16-ICT-Implementations/ICT-Transport-Silicone/ICT-Transport-Silicone_Java_How_to_deploy-221.pdf How to deploy] instead=
The PDF is much more complete.....


----

= Introduction =

You must have a JRE 1.6.x installed. This software has not yet been tested with JRE 1.7.x but is assumed to work.

= Metro =

The software provided by this project makes heavy use of the Java Metro libraries. Currently the version Metro 2.1.1 from http://metro.java.net/2.1.1 is required. Download the ZIP file and extract it locally to perform further steps.
The rest of the configuration depends on the application server you are using.

*Important Note:* peppol-silicone has only partially been tested with Metro 2.2. You may use Metro 2.2u1 from http://metro.java.net/2.2.0-1/ on your own risk, but currently it looks as if everything is working as expected!

== Setup for Tomcat 6.x and 7.x ==

Copy the following files (without the directory structure of the ZIP file) into your Tomcat endorsed directory (you may need to create this directory; it is e.g. {{{/usr/share/tomcat/endorsed}}}):
  * metro/lib/webservices-api.jar

Alternatively you can also copy the webservice-api.jar into the endorsed directory of your JRE but beware of the side effects as this affects all applications running on this JRE and this is probably not intended.

Copy the following files into your Tomcat lib directory ({{{${catalina.lib.home}}}} - e.g. {{{/usr/share/tomcat/lib}}})
  * metro/lib/stax-api.jar
  * metro/lib/webservices-extra.jar
  * metro/lib/webservices-extra-api.jar
  * metro/lib/webservices-rt.jar
  * metro/lib/webservices-tools.jar
Note: ensure that the webservices-api.jar is *only* contained in the endorsed directory and not in the lib directory as well!

Ensure that the endorsed libraries are loaded by Tomcat:
  * Define the following system property on Tomcat start: {{{java.endorsed.dirs=/usr/share/tomcat/endorsed}}} (see the [http://tomcat.apache.org/tomcat-6.0-doc/class-loader-howto.html Tomcat 6 Classloader HOW-TO] or the [http://tomcat.apache.org/tomcat-7.0-doc/class-loader-howto.html Tomcat 7 Classloader HOW-TO])
  * For Tomcat 7 the parameter itself might by already present in the /etc/init.d/tomcat7 file (in case you are using Linux) - just the endorsed directory itself might be missing

If you get startup errors with Tomcat 7, maybe [http://www.java.net/forum/topic/glassfish/metro-and-jaxb/metro-211-and-servlet-version-30-tomcat-many-startup-errors this post] helps you solve the issues. The easiest thing is to remove all predefined non-PEPPOL web applications (like ROOT, examples, docs etc.) which are using Servlet API 3.0 in their web.xml files. If you can't do this, follow the instructions in the post (add {{{metadata-complete="true"}}} in the web.xml to all applications using Servlet API 3.0).

Finally Tomcat must be restarted to make the changes work.

== Setup for Jetty 7.x == 

Metro is handled as a separate "option" in Jetty. Assuming your Jetty installation is in {{{/opt/jetty}}} you need to do the following:
  * Create a new directory {{{/opt/jetty/lib/metro}}}

Copy the following files into the created directory ({{{/opt/jetty/lib/metro}}})
  * metro/lib/webservices-rt.jar

Than modify {{{/opt/jetty/start.ini}}} and add {{{metro}}} to the "OPTIONS": {{{OPTIONS=Server,jsp,jmx,resources,websocket,ext,plus,annotations,metro}}}

Finally a Jetty restart is required.

Important note: the name of the directory created under {{{/opt/jetty/lib}}} must match the name of the option you add!

= Deployment =

== LIME ==
Especially for the LIME server it is recommended to not deploy the web application as a WAR file, because by default all data is stored inside the web application. So instead just create the appropriate context directory manually and copy the compiled web application inside. On update please be careful not to deleted the stored documents!

== Metro ==
For Metro compatibility please make sure that none of the following files resides in your web applications WEB-INF/lib directory because they are provided by the application server:
  * servlet-api.jar
  * jsp-api.jar
  * stax-api.jar
  * webservices-api.jar
  * webservices-extra.jar
  * webservices-extra-api.jar
  * webservices-rt.jar
  * webservices-tools.jar

==> That's the reason why all org.glassfish.metro artifacts in the project pom.xml files are marked with the scope {{{provided}}}.